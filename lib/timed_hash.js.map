{"version":3,"sources":["../src/timed_hash.js"],"names":["TimedHash","constructor","options","maxAgeSec","data","lastPurge","Date","now","add","k","contents","purge","addedAt","get","contains","expiredKeys","forEach","count","Object","keys","length","filter"],"mappings":";;;;;AAEe,MAAMA,SAAN,CAAgB;;AAK9BC,aAAYC,OAAZ,EAA4B;AAC3B,OAAKA,OAAL,GAAeA,WAAW,EAA1B;AACA,OAAKA,OAAL,CAAaC,SAAb,GAAyB,KAAKD,OAAL,CAAaC,SAAb,IAA0B,IAAnD;AACA,OAAKC,IAAL,GAAY,EAAZ;AACA,OAAKC,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AACA;;AAEDC,KAAIC,CAAJ,EAAcC,QAAd,EAA+B;AAC9B,MAAG,KAAKL,SAAL,GAAiBC,KAAKC,GAAL,KAAa,IAAjC,EAAuC;AACtC,QAAKI,KAAL;AACA;;AAED,OAAKP,IAAL,CAAUK,CAAV,IAAe;AACdC,aAASA,QADK;AAEdE,YAASN,KAAKC,GAAL;AAFK,GAAf;AAIA;;AAEDM,KAAIJ,CAAJ,EAAc;AACb,SAAO,CAAC,KAAKL,IAAL,CAAUK,CAAV,KAAgB,EAAjB,EAAqBC,QAA5B;AACA;;AAEDI,UAASL,CAAT,EAAmB;AAClB,SAAO,KAAKL,IAAL,CAAUK,CAAV,KAAgB,IAAvB;AACA;;AAEDE,SAAQ;AACP,OAAKI,WAAL,GAAmBC,OAAnB,CAA4BP,CAAD,IAAO,OAAO,KAAKL,IAAL,CAAUK,CAAV,CAAzC;AACA,OAAKJ,SAAL,GAAiBC,KAAKC,GAAL,EAAjB;AACA;;AAEDU,SAAQ;AACP,SAAOC,OAAOC,IAAP,CAAY,KAAKf,IAAjB,EAAuBgB,MAA9B;AACA;;AAEDL,eAAuB;AACtB,SAAOG,OAAOC,IAAP,CAAY,KAAKf,IAAjB,EAAuBiB,MAAvB,CAA+BZ,CAAD,IAAO;AAC3C,UAAO,KAAKL,IAAL,CAAUK,CAAV,EAAaG,OAAb,GAAuBN,KAAKC,GAAL,KAAa,KAAKL,OAAL,CAAaC,SAAb,GAAyB,IAApE;AACA,GAFM,CAAP;AAGA;AA5C6B;kBAAVH,S","file":"timed_hash.js","sourcesContent":["// @flow\n\nexport default class TimedHash {\n\tlastPurge:number;\n\tdata:{};\n\toptions:{ maxAgeSec:number };\n\n\tconstructor(options:Object) {\n\t\tthis.options = options || {};\n\t\tthis.options.maxAgeSec = this.options.maxAgeSec || 30.0;\n\t\tthis.data = {};\n\t\tthis.lastPurge = Date.now();\n\t}\n\n\tadd(k:string, contents:Object) {\n\t\tif(this.lastPurge < Date.now() - 1000) {\n\t\t\tthis.purge();\n\t\t}\n\n\t\tthis.data[k] = { \n\t\t\tcontents:contents,\n\t\t\taddedAt: Date.now()\n\t\t};\n\t}\n\n\tget(k:string) {\n\t\treturn (this.data[k] || {}).contents;\n\t}\n\n\tcontains(k:string) {\n\t\treturn this.data[k] != null;\n\t}\n\n\tpurge() {\n\t\tthis.expiredKeys().forEach((k) => delete this.data[k]);\n\t\tthis.lastPurge = Date.now();\n\t}\n\n\tcount() {\n\t\treturn Object.keys(this.data).length\n\t}\n\n\texpiredKeys():string[] {\n\t\treturn Object.keys(this.data).filter((k) => {\n\t\t\treturn this.data[k].addedAt < Date.now() - this.options.maxAgeSec * 1000;\n\t\t});\n\t}\n}\n\n"]}